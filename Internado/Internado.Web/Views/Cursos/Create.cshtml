@{
    ViewData["Title"] = "Crear Curso";
    var docentes = ViewBag.Docentes as List<Internado.Infrastructure.Models.Usuario> ?? new List<Internado.Infrastructure.Models.Usuario>();
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-plus-circle"></i> Crear Nuevo Curso</h2>
        </div>
        <div class="col-auto">
            <a href="@Url.Action("Index")" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <form asp-action="Create" method="post">
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group mb-3">
                            <label for="nombre" class="form-label">
                                <i class="bi bi-book"></i> Nombre del Curso <span class="text-danger">*</span>
                            </label>
                            <input type="text" name="nombre" id="nombre"
                                   class="form-control"
                                   placeholder="Ej: Matemáticas I"
                                   required
                                   maxlength="100">
                            <div class="form-text">Máximo 100 caracteres</div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="docentePrincipalId" class="form-label">
                                <i class="bi bi-person-badge"></i> Docente Principal <span class="text-danger">*</span>
                            </label>
                            <select name="docentePrincipalId" id="docentePrincipalId"
                                    class="form-select"
                                    required>
                                <option value="">-- Seleccionar --</option>
                                @foreach (var docente in docentes)
                                {
                                    <option value="@docente.Id">@docente.Nombre</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">
                        <i class="bi bi-people"></i> Docentes Colaboradores (opcional)
                    </label>
                    <div class="form-text mb-2">
                        Seleccione los docentes colaboradores que tendrán acceso al curso
                    </div>

                    @if (docentes.Any())
                    {
                        <div class="row">
                            @foreach (var docente in docentes)
                            {
                                <div class="col-md-4 mb-2">
                                    <div class="form-check">
                                        <input type="checkbox"
                                               name="docenteIds"
                                               value="@docente.Id"
                                               id="docente_@docente.Id"
                                               class="form-check-input">
                                        <label for="docente_@docente.Id" class="form-check-label">
                                            @docente.Nombre
                                        </label>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            No hay docentes disponibles en el sistema.
                        </div>
                    }
                </div>

                <div class="border-top pt-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Guardar Curso
                    </button>
                    <a href="@Url.Action("Index")" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-deseleccionar docente principal si se selecciona como colaborador
        document.getElementById('docentePrincipalId').addEventListener('change', function() {
            const docentePrincipalId = this.value;
            if (docentePrincipalId) {
                const checkbox = document.getElementById('docente_' + docentePrincipalId);
                if (checkbox) {
                    checkbox.checked = false;
                    checkbox.disabled = true;
                }

                // Habilitar otros checkboxes
                document.querySelectorAll('input[name="docenteIds"]').forEach(cb => {
                    if (cb.id !== 'docente_' + docentePrincipalId) {
                        cb.disabled = false;
                    }
                });
            }
        });
    </script>
}
